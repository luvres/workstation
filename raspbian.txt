################
### Raspbian ###
################

### Install
#-----------
dd bs=4096k if=2017-07-05-raspbian-jessie.img of=/dev/sdb status=progress; sync
dd bs=4096k if=2017-08-16-raspbian-stretch.img of=/dev/sdb status=progress; sync

### (Install in Raspberry Pi for expand disk)

### f2fs -> sudo apt-get install f2fs-tools
umount /dev/sdb1 /dev/sdb2
mkdir root_fs boot 2>/dev/null
mount /dev/sdb2 root_fs
rm backup_root_fs -fR; cp -a root_fs backup_root_fs
umount /dev/sdb2
mkfs.f2fs /dev/sdb2
mount -t f2fs /dev/sdb2 root_fs
cp -a backup_root_fs/* root_fs
mount /dev/sdb1 boot

# fstab
sed -i '/ext4/s/noatime/noatime,discard/' root_fs/etc/fstab
sed -i 's/ext4/f2fs/' root_fs/etc/fstab
echo 'tmpfs   /tmp     tmpfs   nodev,nosuid,size=1G  0 0' >>root_fs/etc/fstab

# cmdline.txt
sed -i 's/$/& rootfstype=f2fs/' boot/cmdline.txt
sed -i 's/$/& usbhid.mousepoll=0/' boot/cmdline.txt #Mouse lag

# config.txt
sed -i '/hdmi_drive=2/s/#//' boot/config.txt
echo 'dtparam=sd_overclock=100' >>boot/config.txt #Class 10 SD card

# IP Static
echo 'interface eth0' >>root_fs/etc/dhcpcd.conf
echo 'static ip_address=169.8.192.130/25' >>root_fs/etc/dhcpcd.conf
echo 'static routers=169.8.192.254' >>root_fs/etc/dhcpcd.conf
echo 'static domain_name_servers=191.96.255.126' >>root_fs/etc/dhcpcd.conf

# 1.4 ghz overclock
cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
sed -i '/arm_freq/s/$/& \
gpu_mem=400 \
arm_freq=1400 \
over_voltage=6 \
sdram_freq=500 \
core_freq=500 \
gpu_freq=400/' /boot/config.txt


sync; umount /dev/sdb1 /dev/sdb2


##############
### Access ###
##############
echo '' >$HOME/.ssh/known_hosts
ssh -l pi raspberrypi
# login: pi
# passwd: raspberry
sudo su
echo "root:aamu02" | chpasswd
echo "pi:aamu02" | chpasswd

# Bashrc
sed -i '/alias l/s/#//g' $HOME/.bashrc

# Update
sudo apt-get update && sudo apt-get upgrade -y

### Packages
sudo apt-get install -y \
htop tmux freeglut3-dev synaptic cifs-utils f2fs-tools gftp deluge debootstrap

### Docker
curl -sSL https://get.docker.com | sh
sudo usermod -aG docker $USER

### Mountpoint
sudo mount /dev/sda1 /mnt
sudo sh -c "echo '#/dev/sda1 /mnt auto noatime 0 0' >>/etc/fstab"

# Lighttpd
docker run --name ftp -h lighttpd \
-p 80:80 \
-v /mnt/ftp:/var/www \
-d izone/arm:lighttpd
#docker start ftp

# Nginx
docker run --name ftp -h nginx \
-p 80:80 \
-v /mnt/ftp:/usr/share/nginx/html \
-d izone/arm32v7:nginx \
&& docker exec -ti ftp sed -i '/sendfile/s/on;/on;\n    autoindex       on;/' /etc/nginx/nginx.conf \
&& docker restart ftp

#rsync -avz --delete --progress /aux/ pi@raspberrypi:/mnt/ftp
#sshpass -p "aamu02" rsync -avz --delete --progress /aux/ pi@raspberrypi:/mnt/ftp


### FreeCAD Build
#-----------------
sudo apt install -y \
git \
build-essential \
cmake \
python \
python-matplotlib \
libtool \
libcoin80-dev \
libsoqt4-dev \
libxerces-c-dev \
libboost-dev \
libboost-filesystem-dev \
libboost-regex-dev \
libboost-program-options-dev \
libboost-signals-dev \
libboost-thread-dev \
libboost-python-dev \
libqt4-dev \
libqt4-opengl-dev \
qt4-dev-tools \
python-dev \
python-pyside \
pyside-tools \
liboce-modeling-dev \
liboce-visualization-dev \
liboce-foundation-dev \
liboce-ocaf-lite-dev \
liboce-ocaf-dev \
oce-draw \
libeigen3-dev \
libqtwebkit-dev \
libshiboken-dev \
libpyside-dev \
libode-dev \
swig \
libzipios++-dev \
libfreetype6 \
libfreetype6-dev \
netgen-headers \
libmedc-dev \
libvtk6-dev \
libproj-dev

# Source FreeCAD
#tmux new-session -s freecad
#tmux attach -t freecad
mkdir $HOME/1uvr3z 2>/dev/null && cd $HOME/1uvr3z
git clone https://github.com/FreeCAD/FreeCAD.git $HOME/1uvr3z/FreeCAD
mkdir -p $HOME/1uvr3z/freecad-build 2>/dev/null && cd $HOME/1uvr3z/freecad-build

# Build
cmake -DCMAKE_BUILD_TYPE=Debug -DBUILD_FEM_NETGEN=ON $HOME/1uvr3z/FreeCAD
time make #-j3

# Reset git
git reset --hard HEAD

# Pull git
pull git


### QtCreator
#-------------
sudo apt-get install -y qt5-default qtcreator


### Arduino IDE
#---------------
VERSION_ARDUINO=1.8.1
wget -c https://downloads.arduino.cc/arduino-${VERSION_ARDUINO}-linuxarm.tar.xz
tar Jxf arduino-${VERSION_ARDUINO}-linuxarm.tar.xz
cd arduino-${VERSION_ARDUINO}/
sudo ./install.sh

### Git
#-------
git config --global user.name "luvres"
git config --global user.email "luvres@hotmail.com"

ssh-keygen
cat $HOME/.ssh/id_rsa.pub | xclip -sel clip # $HOME/.ssh/config
ssh -T git@github.com
ssh -T -p443 git@ssh.github.com

git config --global credential.helper cache
git add . && git commit -am "Primeiro commit" && git push

########################
### Stratch repo
sudo sh -c 'echo "deb http://mirrordirector.raspbian.org/raspbian/ stretch main contrib non-free rpi" >/etc/apt/sources.list.d/stretch.list'
# Update
sudo apt-get update && sudo apt-get -t stable upgrade

# Keyboard map
#echo 'setxkbmap -model abnt2 -layout br -variant abnt2' >>$HOME/.bashrc

### Swap File
dd if=/dev/zero of=/swapfile bs=1M count=512
chmod 0600 /swapfile 
mkswap /swapfile
swapon /swapfile
echo '/swapfile none swap defaults 0 0' >>/etc/fstab

### 64-bit kernel
wget -c http://www.finnie.org/software/raspberrypi/ubuntu-rpi3/20160517-raspi3-arm64-firmware-kernel.tar.xz
tar Jxf 20160517-raspi3-arm64-firmware-kernel.tar.xz
mkdir /root/boot && mv /boot/* /root/boot
cp boot/firmware/* /boot
cp -a lib/modules/4.5.0+ /lib/modules
cp lib/firmware/brcm/* /lib/firmware/brcm/
rm 20160517-raspi3-arm64-firmware-kernel.tar.xz boot/ lib/ -fR
reboot


